(function(e){function u(b,a){for(var c=null;b;){if(b.getAttribute){var f=b.getAttribute("data-navigation");c||b.tagName!==a||"refresh"!==f||(c=b);if("noajax"===f)return null}b=b.parentNode}return c}function w(b,a){a=a||{};a["include-current"]=!0;l(g,b,!0,a)}function l(b,a,c,f,d){var g={link:b,data:a,target:f};m("navigating",g,null);c={history:c?"add":null,title:d?d:e.document.title};d=new e.XMLHttpRequest;d.onreadystatechange=x(d,g,c);d.open(a?"post":"get",y(b,f));a&&d.setRequestHeader("Content-Type",
"application/json");d.send(e.JSON.stringify(a))}function y(b,a){b+=0<b.indexOf("?")?"&":"?";b+="refreshajax="+e.encodeURIComponent(g);b+="&navigation="+(a?"refresh":"history");a&&(b=r(a,b,"include-current"),b=r(a,b,"current-keys"),b=r(a,b,"to-keys"));return b}function r(b,a,c){(b=b.getAttribute("data-"+c)||b[c])&&(a+="&"+c.replace("-","")+"="+e.encodeURIComponent(b));return a}function x(b,a,c){var f=g;return function(){if(4===b.readyState)if(200===b.status){var d=e.JSON.parse(b.responseText);d.Title&&
(c.title=d.Title);c.panels=d.Panels;c.link=d.Link;m("navigated",a,c);d.RedirectLink?e.location.href=d.RedirectLink:g===f&&v(a,c)}else m("navigated",a,c)}}function v(b,a){var c={};c.link=g;c.title=e.document.title;c.panels={};m("updating",b,a);if(a.panels){for(var f in a.panels){var d=e.document.getElementById(f);d&&(c.panels[f]=d.innerHTML,d.innerHTML=a.panels[f])}m("updated",b,a);f=a.link;g!==f&&(d=a.link,t[g+"&"+d]=a,t[d+"&"+g]=c,-1===n.indexOf(d)&&(p[d]=[],n.push(d)),-1===p[g].indexOf(d)&&(p[g].push(d),
p[d].push(g)),"add"===a.history&&e.history.pushState(a.title,a.title,f),"replace"===a.history&&e.history.replaceState(a.title,a.title,f));e.document.title=a.title;g=f}}function z(b,a){for(var c={},f={},d=[],e=n.length,g=0;g<n.length;g++)d.push(n[g]),f[n[g]]=e;for(var k=f[b]=0;0!==d.length;){k++;var h=d.sort(function(a,b){return f[a]-f[b]})[0];if(h===a){for(d=[];a;)d.push(a),a=c[a];return d.reverse()}for(var m=p[h],g=0;g<m.length;g++){var l=m[g];f[l]===e&&(f[l]=k,c[l]=h)}d.shift()}return null}function q(b){return function(a){k[b]||
(k[b]=[]);k[b].push(a)}}function m(b,a,c){if(k[b])for(var f=0;f<k[b].length;f++)k[b][f](a,c)}if(e.history&&e.history.pushState){var h={};e.document.addEventListener("click",function(b){var a=b.target,c=u(a,"A");b.ctrlKey||b.shiftKey||!c||(b.preventDefault(),l(c.getAttribute("href"),null,!0,c));"INPUT"!==a.tagName&&"BUTTON"!==a.tagName||!a.name||("submit"===a.type&&(h[a.name]=a.value),"image"===a.type&&(h[a.name+".x"]=e.Math.max(0,b.offsetX),h[a.name+".y"]=e.Math.max(0,b.offsetY)))});e.document.addEventListener("submit",
function(b){var a=u(b.target,"FORM");if(a){b.preventDefault();b=a.getAttribute("action");for(var c=a.elements,f={},d=0;d<c.length;d++){var e=c[d];!A.test(e.tagName)||!e.name||B.test(e.type)||e.disabled||C.test(e.type)&&!e.checked||(f[e.name]=e.value)}for(var g in h)f[g]=h[g];h={};l(b,f,!0,a)}});var A=/^INPUT|TEXTAREA|SELECT$/,B=/^button|image|submit|reset|file$/,C=/^checkbox|radio$/,g=e.location.pathname+e.location.search,p={};p[g]=[];var n=[g],t={};e.addEventListener("popstate",function(b){var a=
e.location.pathname+e.location.search;if(g!==a){var c=z(g,a);if(c)for(b=0;b<c.length-1;b++){var a={link:c[b+1],target:e},f=t[c[b]+"&"+c[b+1]];f.history=null;v(a,f)}else l(a,null,!1,e,b.state)}});var k={};e.refreshAjax={navigate:w,navigating:q("navigating"),navigated:q("navigated"),updating:q("updating"),updated:q("updated")}}})(window);