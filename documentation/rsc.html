<html>
<head>
    <title>RSC</title>
    <meta name="viewport" content="width=device-width">
    <style>
      :root {
        --primary-color: #f9858b;
        --secondary-color: #ed335f;
      }    
    </style>
    <link rel="stylesheet" href="../css/prism.css">
    <link rel="stylesheet" href="../css/navigation.css">
</head>
<body>
    <div id="banner">
      <a href=".."><img alt="logo" src="../img/logo.png" /></a>
      <a href="native/setup.html">React Native</a>
      <a href="https://github.com/grahammendick/navigation">GitHub</a>
    </div>
    <div id="content">
        <div id="menu">
          <h2>
            <img alt="web" src="../img/web.png" />
            React
          </h2>
          <div id="items">
            <a href="setup.html">Setup</a>
            <a href="hello-world.html">Hello World</a>
            <a href="state-navigation.html">State Navigation</a>
            <a href="navigation-data.html">Navigation Data</a>
            <a href="routes.html">Routes</a>
            <a href="current-data.html">Current Data</a>
            <a href="rsc.html" class="selected">RSC</a>
            <a href="html5-history.html">HTML5 History</a>
            <a href="navigation-lifecycle.html">Navigation Lifecycle</a>
            <a href="reusable-components.html">Reusable Components</a>
            <a href="typescript.html">TypeScript</a>
            <a href="examples.html">Examples</a>
            <h3>Mobile</h3>
            <a href="mobile/setup.html">Setup</a>
            <a href="mobile/hello-world.html">Hello World</a>
            <a href="mobile/animated-navigation.html">Animated Navigation</a>
            <a href="mobile/clean-urls.html">Clean Urls</a>
            <a href="mobile/scene-navigation-lifecycle.html">Navigation Lifecycle</a>
            <a href="mobile/shared-element-navigation.html">Shared Element Navigation</a>
            <a href="mobile/examples.html">Examples</a>
          </div>
        </div>
        <div id="article">
            <h1>RSC</h1>
            <p>
                The App router from Next.js introduced a lot of weird rules, for example, around partial page updates and access to the URL on the server. But they have nothing to do with RSC (React Server Components) and everything to do with Next.js. There are actually very few rules when it comes to RSC, as you can see with the Navigation router. All the Navigation router documentation, apart from the setup, works the same whether you're using RSC or not.
            </p>
            <h2>Setting up the Bundler</h2>
            <p>
                The Navigation router has <a href="">Parcel</a> and <a href="">Webpack</a> RSC samples you can compare. Although their setup code is very different, the application code is identical. The following covers the files from Parcel setup since Webpack's RSC support isn't production-ready.
                <ul>
                    <li>
                        <a href="">server.ts</a> - runs the express web server. The <code>get</code> handler returns the initial RSC stream; <code>post</code> handler streams RSC for client side navigation; and <code>put</code> handler is for HMR (hot module replacement) updates.
                    </li>
                    <li>
                        <a href="">client.ts</a> - hydrates the App from the initial RSC stream
                    </li>
                    <li>
                        <a href="">HmrContext.ts</a> - supports HMR updates
                    </li>
                    <li>
                        <a href="">RootProvider.ts</a> - client component that hosts the <code>NavigationHandler</code> and where you render your custom providers
                    </li>
                    <li>
                        <a href="">App.ts</a> - server component that renders the application shell and where you configure your scenes
                    </li>
                </ul>
            </p>
            <pre><code class="language-jsx">'use server-entry'

const Mail = async () => {
  const {data} = useNavigationEvent()
  const {id, expand} = data;
  const mail = await fetchMail(id);
};</code></pre>
            <p>
            </p>
            <pre><code class="language-js">app.post('*', async (req, res) => {
  const sceneViews: any = {
    inbox: Inbox,
    mail: Mail,
    compose: Compose
  };
  const {url, sceneViewKey} = req.body;
  const View = sceneViews[sceneViewKey];</code></pre>
            <h2>Refetching Scenes</h2>
            <p>
            </p>
            <pre><code class="language-jsx">'use client'

const Thread = ({mail}) => {
  const {data} = useNavigationEvent();
  const {expand} = data;
  if (!expand) return null;
  return (
    &lt;ul>
      {mail.thread.map({id, content}) => (
        &lt;li key={id}>{content}&lt;/li>
      )}
    &lt;/ul>
  )
};</code></pre>
            <p>
            </p>
            <pre><code class="language-jsx">&lt;SceneView active="mail" dataKeyDeps={[]}>
  &lt;Mail />
&lt;/SceneView></code></pre>
        </div>
    </div>
    <script type="text/javascript" src="../js/prism.js"></script>
</body>
</html>