<html>
<head>
    <title>RSC</title>
    <meta name="viewport" content="width=device-width">
    <style>
      :root {
        --primary-color: #f9858b;
        --secondary-color: #ed335f;
      }    
    </style>
    <link rel="stylesheet" href="../../css/prism.css">
    <link rel="stylesheet" href="../../css/navigation.css">
</head>
<body>
    <div id="banner">
      <a href="../.."><img alt="logo" src="../../img/logo.png" /></a>
      <a href="../native/setup.html">React Native</a>
      <a href="https://github.com/grahammendick/navigation">GitHub</a>
    </div>
    <div id="content">
        <div id="menu">
          <h2>
            <img alt="web" src="../../img/web.png" />
            RSC
          </h2>
          <div id="items">
            <a href="../setup.html">Setup</a>
            <a href="../hello-world.html">Hello World</a>
            <a href="../state-navigation.html">State Navigation</a>
            <a href="../navigation-data.html">Navigation Data</a>
            <a href="../routes.html">Routes</a>
            <a href="../current-data.html">Current Data</a>
            <a href="../html5-history.html">HTML5 History</a>
            <a href="../navigation-lifecycle.html">Navigation Lifecycle</a>
            <a href="../reusable-components.html">Reusable Components</a>
            <a href="../typescript.html">TypeScript</a>
            <a href="../rsc.html">RSC</a>
            <a href="../examples.html">Examples</a>
            <h3>Mobile</h3>
            <a href="setup.html">Setup</a>
            <a href="hello-world.html">Hello World</a>
            <a href="animated-navigation.html">Animated Navigation</a>
            <a href="clean-urls.html">Clean Urls</a>
            <a href="scene-navigation-lifecycle.html">Navigation Lifecycle</a>
            <a href="shared-element-navigation.html">Shared Element Navigation</a>
            <a href="rsc.html" class="selected">RSC</a>
            <a href="examples.html">Examples</a>
          </div>
        </div>
        <div id="article">
            <h1>RSC</h1>
            <h2>Setting up the Bundler</h2>
            <p>
                The Navigation router has a <a href="https://github.com/grahammendick/navigation/tree/master/NavigationReactMobile/sample/rsc">Parcel RSC mobile sample</a> that you can clone. The only files you need to change are <a href="https://github.com/grahammendick/navigation/blob/master/NavigationReactMobile/sample/rsc/src/App.tsx">App.tsx</a>, <a href="https://github.com/grahammendick/navigation/blob/master/NavigationReactMobile/sample/rsc/src/stateNavigator.ts">stateNavigator.ts</a> and <a href="https://github.com/grahammendick/navigation/blob/master/NavigationReactMobile/sample/rsc/src/server.tsx">server.tsx</a>. Replace the people/person scenes and components with your own ones. Add <code>use-server entry</code> to each scene component so that Parcel splits the bundle there. Also mark them as <code>async</code> to enable data-fetching on the server.
            </p>
            <h2>Handling Scene function props</h2>
            <p>
                We follow the setup guide for our email example but when we run it we get an error. We're passing a function from a server component to a client component, something disallowed by RSC. The culprit is the <code>sharedElements</code> prop on the Scene. Instead, we switch to the equivalent prop on the <code>NavigationStack</code>. It has an extra parameter that provides the current scene. Then we create a <code>Stack</code> client component wrapper so we can safely pass the function in.
            </p>
            <pre><code class="language-jsx">'use client'

const Stack = ({children}) => (
  &lt;NavigationStack
    sharedElements={(scene, data) => scene.key === 'mail' ? [`mail${data.id}`] : undefined}>
    {children}
  &lt;/NavigationStack>
)</code></pre>
            <p>
                As soon as we render our new <code>Stack</code> component in place of the <code>NavigationStack</code>, our email example starts working. Server-rendered and bundle-split all thanks to RSC.
            </p>
            <pre><code class="language-jsx">&lt;Stack>
  &lt;Scene stateKey="inbox">&lt;Inbox />&lt;/Scene>
  &lt;Scene stateKey="mail">&lt;Mail />&lt;/Scene>
  &lt;Scene stateKey="compose">&lt;Compose />&lt;/Scene>
&lt;/Stack>
</code></pre>
            <p>
            </p>
        </div>
    </div>
    <script type="text/javascript" src="../../js/prism.js"></script>
</body>
</html>