/**
 * Navigation v4.0.2
 * (c) Graham Mendick - http://grahammendick.github.io/navigation/
 * License: Apache-2.0
 */
!function(t){"use strict";function e(t,r,o){function i(o){var i=r.parseLink(o),s=i.state,u=i.data,l=new n;return l.state=s,l.url=o,l.crumbs=u[s.crumbTrailKey],delete u[s.crumbTrailKey],l.data=u,l.nextCrumb=new a(u,s,o,r.getLink(s,u),!1),e(t,r,l)}return void 0===o&&(o=new n),{url:o.url,navigate:function(e,n){if(!t[e])throw new Error(e+" is not a valid State");"function"==typeof n&&(n=n(o.data));var a=r.getLink(t[e],n,o.crumbs,o.nextCrumb);if(null==a)throw new Error("Invalid route data, a mandatory route parameter has not been supplied a value");return i(a)},navigateBack:function(t){if(!(t<=o.crumbs.length&&t>0))throw new Error("The distance parameter must be greater than zero and less than or equal to the number of Crumbs ("+o.crumbs.length+")");return i(o.crumbs[o.crumbs.length-t].url)},refresh:function(t){"function"==typeof t&&(t=t(o.data));var e=r.getLink(o.state,t,o.crumbs,o.nextCrumb);if(null==e)throw new Error("Invalid route data, a mandatory route parameter has not been supplied a value");return i(e)}}}function r(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var n=function(){function t(){this.oldState=null,this.oldData={},this.oldUrl=null,this.previousState=null,this.previousData={},this.previousUrl=null,this.state=null,this.data={},this.url=null,this.title=null,this.crumbs=[],this.nextCrumb=null}return t.prototype.clear=function(){this.oldState=null,this.oldData={},this.oldUrl=null,this.previousState=null,this.previousData={},this.previousUrl=null,this.state=null,this.data={},this.url=null,this.title=null,this.crumbs=[],this.nextCrumb=null},t.prototype.includeCurrentData=function(t,e){if(!e){e=[];for(var r in this.data)e.push(r)}for(var n={},a=0;a<e.length;a++)n[e[a]]=this.data[e[a]];for(var r in t)n[r]=t[r];return n},t}(),a=function(){function t(t,e,r,n,a){this.data=t||{},this.state=e,this.last=a,this.title=e.title,this.url=r,this.crumblessUrl=n}return t}(),o=function(){function t(t){void 0===t&&(t=!1),this.replaceQueryIdentifier=!1,this.disabled="undefined"==typeof window||!("onhashchange"in window),this.replaceQueryIdentifier=t}return t.prototype.init=function(t){this.navigateHistory=function(){return t()},this.disabled||(window.addEventListener?window.addEventListener("hashchange",this.navigateHistory):window.attachEvent("onhashchange",this.navigateHistory))},t.prototype.addHistory=function(t,e){var r=this.getHref(t);this.disabled||location.hash===r||(e?location.replace(r):location.hash=r)},t.prototype.getCurrentUrl=function(){return this.getUrl(location)},t.prototype.getHref=function(t){if(null==t)throw new Error("The Url is invalid");return"#"+this.encode(t)},t.prototype.getUrl=function(t){return this.decode(t.hash.substring(1))},t.prototype.stop=function(){this.disabled||(window.removeEventListener?window.removeEventListener("hashchange",this.navigateHistory):window.detachEvent("onhashchange",this.navigateHistory))},t.prototype.encode=function(t){return this.replaceQueryIdentifier?t.replace("?","#"):t},t.prototype.decode=function(t){return this.replaceQueryIdentifier?t.replace("#","?"):t},t}(),i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},s=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},u=function(){function t(t,e){this.key=t,this.name=e}return t.prototype.convertFrom=function(t,e){return void 0===e&&(e=!1),null},t.prototype.convertTo=function(t){return null},t}(),l=function(t){function e(e,r){var n=t.call(this,r,e.name+"array")||this;return n.converter=e,n}return r(e,t),e.prototype.convertFrom=function(t,r){var n=[];if("string"==typeof t)if(r)n.push(this.converter.convertFrom(t));else for(var a=t.split(e.SEPARATOR),o=0;o<a.length;o++)0!==a[o].length?n.push(this.converter.convertFrom(a[o].replace(/0-/g,"-"))):n.push(null);else for(var o=0;o<t.length;o++)0!==t[o].length?n.push(this.converter.convertFrom(t[o])):n.push(null);return n},e.prototype.convertTo=function(t){for(var r=[],n=[],a=0;a<t.length;a++)if(null!=t[a]&&t[a].toString()){var o=this.converter.convertTo(t[a]).val;n.push(o),r.push(o.replace(/-/g,"0-"))}else n.push(""),r.push("");return{val:r.join(e.SEPARATOR),arrayVal:n}},e.SEPARATOR="1-",e}(u),h=function(t){function e(e){return t.call(this,e,"boolean")||this}return r(e,t),e.prototype.convertFrom=function(t){if("true"!==t&&"false"!==t)throw Error(t+" is not a valid boolean");return"true"===t},e.prototype.convertTo=function(t){return{val:t.toString()}},e}(u),p=function(t){function e(e){return t.call(this,e,"date")||this}return r(e,t),e.prototype.convertFrom=function(t){var e=t.split("-");if(3!==e.length)throw Error(t+" is not a valid date");var r=new Date(+e[0],+e[1]-1,+e[2]);if(isNaN(+r))throw Error(t+" is not a valid date");return r},e.prototype.convertTo=function(t){return{val:t.getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getDate()).slice(-2)}},e}(u),c=function(t){function e(e){return t.call(this,e,"number")||this}return r(e,t),e.prototype.convertFrom=function(t){if(isNaN(+t))throw Error(t+" is not a valid number");return+t},e.prototype.convertTo=function(t){return{val:t.toString()}},e}(u),f=function(t){function e(e){return t.call(this,e,"string")||this}return r(e,t),e.prototype.convertFrom=function(t){if("string"!=typeof t)throw Error(t+" is not a valid string");return t},e.prototype.convertTo=function(t){return{val:t.toString()}},e}(u),v=function(){function t(){this.keyToConverterList={},this.nameToKeyList={};for(var t=[new f("0"),new h("1"),new c("2"),new p("3")],e=0;e<t.length;e++){var r=t[e],n=new l(r,"a"+r.key);this.keyToConverterList[r.key]=r,this.keyToConverterList[n.key]=n,this.nameToKeyList[r.name]=r.key,this.nameToKeyList[n.name]=n.key}}return t.prototype.getConverterFromKey=function(t){return this.keyToConverterList[t]},t.prototype.getConverterFromName=function(t){var e=this.nameToKeyList[t];if(!e)throw new Error("No TypeConverter found for "+t);return this.getConverterFromKey(e)},t}(),d=function(){function t(){this.converterFactory=new v}return t.prototype.formatData=function(t,e,r){var n={},a={};for(var o in e){var i=e[o];null!=i&&i.toString()&&this.formatDataItem(t,o,i,n,a)}return t.trackCrumbTrail&&r.length>0&&this.formatDataItem(t,t.crumbTrailKey,r,n,a),{data:n,arrayData:a}},t.prototype.formatDataItem=function(t,e,r,n,a){var o=this.formatURLObject(e,r,t);(r=o.val)!==t.formattedDefaults[e]&&(n[e]=r,a[e]=o.arrayVal)},t.decodeUrlValue=function(t){return t.replace(/0_/g,"_")},t.encodeUrlValue=function(t){return t.replace(/_/g,"0_")},t.prototype.formatURLObject=function(e,r,n,a){void 0===a&&(a=!1),a=a||n.trackTypes;var o=n.defaultTypes[e]?n.defaultTypes[e]:"string",i=this.getConverter(r),s=i.convertTo(r),u=s.val,l=s.arrayVal;return a&&(u=t.encodeUrlValue(u),l&&(l[0]=t.encodeUrlValue(l[0]))),n.trackTypes&&i.name!==o&&(u+=t.SEPARATOR+i.key,l&&(l[0]=l[0]+t.SEPARATOR+i.key)),{val:u,arrayVal:l}},t.prototype.parseData=function(e,r,n){var a={};for(var o in e)t.isDefault(o,e,r,!!n[o])||(a[o]=this.parseURLString(o,e[o],r,!1,!!n[o]));for(var o in r.defaults)null!=a[o]&&a[o].toString()||(a[o]=r.defaults[o]);return a},t.isDefault=function(t,e,r,n){var a=e[t],o=r.formattedArrayDefaults[t];if(n&&o){if("string"==typeof a&&(a=[a]),a.length!==o.length)return!1;for(var i=0;i<a.length;i++)if(a[i]!==o[i])return!1;return!0}return a===r.formattedDefaults[t]},t.prototype.parseURLString=function(e,r,n,a,o){void 0===a&&(a=!1),void 0===o&&(o=!1),a=a||n.trackTypes;var i=n.defaultTypes[e]||"string",s="string"==typeof r?r:r[0],u=this.converterFactory.getConverterFromName(i).key;if(n.trackTypes&&s.indexOf(t.SEPARATOR)>-1){var l=s.split(t.SEPARATOR);s=l[0],u=l[1]}return a&&(s=t.decodeUrlValue(s)),"string"==typeof r?r=s:r[0]=s,this.converterFactory.getConverterFromKey(u).convertFrom(r,o)},t.prototype.getConverter=function(e){var r=t.getTypeName(e);if("array"===r){for(var n=e,a="string",o=0;o<n.length;o++)if(null!=n[o]&&n[o].toString()){a=t.getTypeName(n[o]);break}r=a+r}return this.converterFactory.getConverterFromName(r)},t.getTypeName=function(t){var e=typeof t;return"object"===e&&(e=Object.prototype.toString.call(t),e=e.substring(8,e.length-1).toLowerCase()),e},t.SEPARATOR="1_",t}(),g=function(){function t(){this.defaults={},this.defaultTypes={},this.formattedDefaults={},this.formattedArrayDefaults={},this.trackCrumbTrail=!1,this.trackTypes=!0}return t.prototype.unloading=function(t,e,r,n,a){n()},t.prototype.navigating=function(t,e,r,n){r()},t.prototype.dispose=function(){},t.prototype.navigated=function(t,e){},t.prototype.urlEncode=function(t,e,r,n){return encodeURIComponent(r)},t.prototype.urlDecode=function(t,e,r,n){return decodeURIComponent(r)},t.prototype.validate=function(t){return!0},t.prototype.truncateCrumbTrail=function(t,e,r){return r},t}(),y=function(){function t(t,e,r){this.pattern="",this.params=[],this.subSegments=[],this.subSegmentPattern=/[{]{0,1}[^{}]+[}]{0,1}/g,this.escapePattern=/[\.+*\^$\[\](){}']/g,this.path=t,this.optional=e,this.parse(r)}return t.prototype.parse=function(t){if(0!==this.path.length){for(var e=this.path.match(this.subSegmentPattern),r=0;r<e.length;r++){var n=e[r];if("{"===n.slice(0,1)){var a=n.substring(1,n.length-1),o="?"===a.slice(-1),i="*"===a.slice(0,1),s=o?a.slice(0,-1):a;s=i?s.slice(1):s,this.params.push({name:s,splat:i}),this.optional=this.optional&&o&&this.path.length===n.length,this.path.length===n.length&&(o=this.optional),this.subSegments.push({name:s,param:!0,splat:i,optional:o});var u=i?".+":"[^/]+";this.pattern+=this.optional?"(/"+u+")":"("+u+")",this.pattern+=o?"?":""}else this.optional=!1,this.subSegments.push({name:n,param:!1,splat:!1,optional:!1}),this.pattern+=n.replace(this.escapePattern,"\\$&")}this.optional||(this.pattern="/"+this.pattern)}},t.prototype.build=function(t,e,r){for(var n="",a=!1,o=!1,i=0;i<this.subSegments.length;i++){var s=this.subSegments[i];if(s.param){var u=t[s.name],l=e[s.name];if(o=s.optional&&(!u||u===l),(this.optional||!o)&&(u=u||l,a=a||!u,u))if(s.splat&&"string"!=typeof u){for(var h=[],i=0;i<u.length;i++)h[i]=r(s.name,u[i]);n+=h.join("/"),"/"===n.slice(-1)&&(n+="/")}else n+=r(s.name,u)}else n+=s.name}return{path:a?null:n,optional:o&&this.optional}},t}(),m=function(){function t(t,e){this.segments=[],this.params=[],this.path=t,this.defaults=e||{},this.parse()}return t.prototype.parse=function(){for(var t,e=this.path.split("/").reverse(),r="",n=0;n<e.length;n++){t=new y(e[n],!t||t.optional,this.defaults),this.segments.unshift(t),r=t.pattern+r;for(var a=[],o=0;o<t.params.length;o++){var i=t.params[o];a.push({name:i.name,optional:t.optional,splat:i.splat})}this.params=a.concat(this.params)}this.pattern=new RegExp("^"+r+"$","i")},t.prototype.match=function(t,e){e||(e=function(t,e,r){return decodeURIComponent(r)});var r=this.pattern.exec(t);if(!r)return null;for(var n={},a=1;a<r.length;a++){var o=this.params[a-1];if(r[a]){var i=o.optional?r[a].substring(1):r[a];if(-1===i.indexOf("/"))n[o.name]=e(this,o.name,i);else{for(var s=i.split("/"),u=[],l=0;l<s.length;l++)u[l]=e(this,o.name,s[l]);n[o.name]=u}}}return n},t.prototype.build=function(t,e){var r=this;t=t||{};for(var n="",a=!0,o=this.segments.length-1;o>=0;o--){var i=this.segments[o],s=i.build(t,this.defaults,function(t,n){return e(r,t,n)});if(!(a=a&&s.optional)){if(null==s.path)return null;n="/"+s.path+n}}return 0!==n.length?n:"/"},t}(),b=function(){function t(){this.routes=[]}return t.prototype.addRoute=function(t,e){t="/"===t.slice(-1)?t.substring(0,t.length-1):t,t="/"===t.substring(0,1)?t.substring(1):t;var r=new m(t,e);return this.routes.push(r),r},t.prototype.match=function(t,e,r){t="/"===t.slice(-1)?t.substring(0,t.length-1):t,t="/"===t.substring(0,1)||0===t.length?t:"/"+t;for(var n=!e,a=0;a<this.routes.length;a++){var o=this.routes[a];if(n){var i=o.match(t,r);if(i)return{route:o,data:i}}else n=o===e}return null},t.prototype.sort=function(t){this.routes.sort(t)},t}(),C=function(){function t(){}return t.prototype.getData=function(e,r){var n=this.router.match(e,r,t.urlDecode);if(!n)return null;var a={},o=n.route,i=n.route,s=i._splat,u=i._state,l=i.params,h=n.data;if(s)for(var p=0;p<l.length;p++){var c=l[p];c.splat&&(a[c.name]=!0)}return{state:u,data:h,separableData:a,route:o}},t.prototype.getRoute=function(e,r,n){void 0===n&&(n={});var a=e._routeInfo,o="";for(var i in a.params)r[i]&&(o+=a.params[i]+",");o=o.slice(0,-1);var s=a.matches[o],u=null;if(s){var l=t.getCombinedData(s.route,r,n);u=s.route.build(l,t.urlEncode)}else{var h=t.findBestMatch(a.routes,r,n);h&&(u=h.routePath,s={route:h.route,data:h.data},a.matches[o]=s)}return{route:u,data:s?s.data:{}}},t.findBestMatch=function(e,r,n){for(var a,o=-1,i=-1,s=0;s<e.length;s++){var u=e[s],l=t.getCombinedData(u,r,n),h=u.build(l,t.urlEncode);if(h){for(var p=0,c={},f=0;f<u.params.length;f++)l[u.params[f].name]&&(c[u.params[f].name]={},p++);(p>o||p===o&&u.params.length<i)&&(a={route:u,data:c,routePath:h},o=p,i=u.params.length)}}return a},t.getCombinedData=function(t,e,r){if(!t._splat)return e;var n={};for(var a in e)n[a]=e[a];for(var o=0;o<t.params.length;o++){var i=t.params[o],s=r[i.name];i.splat&&s&&(n[i.name]=s)}return n},t.urlEncode=function(t,e,r){var n=t._state;return n.urlEncode(n,e,r,!1)},t.urlDecode=function(t,e,r){var n=t._state;return n.urlDecode(n,e,r,!1)},t.prototype.addRoutes=function(t){this.router=new b;for(var e=0;e<t.length;e++)this.addStateRoutes(t[e])},t.prototype.addStateRoutes=function(e){for(var r={routes:[],params:{},matches:{}},n=0,a=t.getRoutes(e),o=0;o<a.length;o++){for(var i=this.router.addRoute(a[o],e.formattedDefaults),s=!1,u=0;u<i.params.length;u++){var l=i.params[u];r.params[l.name]||(r.params[l.name]=n,n++),s=s||l.splat}r.routes.push(i),i._state=e,i._splat=s,i.defaults=t.getCombinedData(i,e.formattedDefaults,e.formattedArrayDefaults)}e._routeInfo=r},t.getRoutes=function(e){var r=[],n=e.route;if("string"==typeof n)r=r.concat(t.expandRoute(n));else for(var a=0;a<n.length;a++)r=r.concat(t.expandRoute(n[a]));return r},t.expandRoute=function(t){for(var e=[],r=t.split("+"),n="",a=0;a<r.length;a++)n+=r[a],e.push(n);return e},t}(),w=function(){function t(){this.navigationDataManager=new d,this.router=new C}return t.prototype.buildStates=function(t){for(var e=[],r={},n=0;n<t.length;n++){var a=t[n],o=new g;for(var i in a)o[i]=a[i];if(!o.key)throw new Error("State key is mandatory");if(null==o.route&&(o.route=o.key),o.trackCrumbTrail){o.trackCrumbTrail=!0,o.crumbTrailKey="crumb";var s=a.trackCrumbTrail;"string"==typeof s&&(o.crumbTrailKey=s),o.defaultTypes[o.crumbTrailKey]="stringarray"}for(var i in o.defaults){o.defaultTypes[i]||(o.defaultTypes[i]=this.navigationDataManager.getConverter(o.defaults[i]).name);var u=this.navigationDataManager.formatURLObject(i,o.defaults[i],o);o.formattedDefaults[i]=u.val,u.arrayVal&&(o.formattedArrayDefaults[i]=u.arrayVal)}if(r[o.key])throw new Error("A State with key "+o.key+" already exists");r[o.key]=!0,e.push(o)}return this.router.addRoutes(e),e},t.prototype.getLink=function(t,e,r,n){var a=[];if(r){r=r.slice(),n&&r.push(n),r=t.truncateCrumbTrail(t,s({},t.defaults,e),r);for(var o=0;o<r.length;o++)a.push(r[o].crumblessUrl)}return this.getNavigationLink(t,e,a)},t.prototype.getNavigationLink=function(t,e,r){var n=this.navigationDataManager.formatData(t,e,r),a=n.data,o=n.arrayData,i=this.router.getRoute(t,a,o);if(null==i.route)return null;var s=[];for(var u in a)if(!i.data[u]){var l=o[u],h=t.urlEncode(t,null,u,!0);if(l)for(var p=0;p<l.length;p++)s.push(h+"="+t.urlEncode(t,u,l[p],!0));else s.push(h+"="+t.urlEncode(t,u,a[u],!0))}return s.length>0&&(i.route+="?"+s.join("&")),i.route},t.prototype.parseLink=function(t,e,r){void 0===r&&(r="");var n=t.indexOf("?"),a=n<0?t:t.substring(0,n),o=n>=0?t.substring(n+1):null,i=this.router.getData(a,e);if(!i)throw new Error("The Url "+t+" is invalid"+(r||"\nNo match found"));var s=i.state,u=i.data,l=i.separableData,h=i.route;try{var p=this.getNavigationData(o,s,u||{},l)}catch(t){r+="\n"+t.message}return p||this.parseLink(t,h,r)},t.prototype.getNavigationData=function(t,e,r,n){if(t)for(var a=t.split("&"),o=0;o<a.length;o++){var i=a[o].split("="),s=e.urlDecode(e,null,i[0],!0),u=e.urlDecode(e,s,i[1],!0);n[s]=!0;var l=r[s];l?("string"==typeof l&&(r[s]=l=[l]),l.push(u)):r[s]=u}r=this.navigationDataManager.parseData(r,e,n);var h=r[e.crumbTrailKey];return delete r[e.crumbTrailKey],e.validate(r)?(r[e.crumbTrailKey]=this.getCrumbs(h),{state:e,data:r}):null},t.prototype.getCrumbs=function(t){for(var e=[],r=t?t.length:0,n=0;n<r;n++){var o=t[n];if(!o||"/"!==o.substring(0,1))throw new Error(o+" is not a valid crumb");var i=this.parseLink(o),s=i.state,u=i.data;delete u[s.crumbTrailKey];var l=this.getNavigationLink(s,u,t.slice(0,n));e.push(new a(u,s,l,o,n+1===r))}return e},t}(),T=function(){function t(t,e){this.NAVIGATE_HANDLER_ID="navigateHandlerId",this.navigateHandlerId=1,this.navigateHandlers={},this.stateHandler=new w,this.stateContext=new n,this.states={},t&&this.configure(t,e)}return t.prototype.configure=function(t,e){var r=this;this.historyManager&&this.historyManager.stop(),this.historyManager=e||new o,this.historyManager.init(function(t){void 0===t&&(t=r.historyManager.getCurrentUrl()),r.stateContext.url!==t&&r.navigateLink(t,void 0,!0)});var n=this.stateHandler.buildStates(t);this.states={};for(var a=0;a<n.length;a++)this.states[n[a].key]=n[a]},t.prototype.setStateContext=function(t,e,r){if(this.stateContext.oldState=this.stateContext.state,this.stateContext.oldData=this.stateContext.data,this.stateContext.oldUrl=this.stateContext.url,this.stateContext.state=t,this.stateContext.url=r,this.stateContext.title=t.title,this.stateContext.crumbs=e[t.crumbTrailKey],delete e[t.crumbTrailKey],this.stateContext.data=e,this.stateContext.nextCrumb=new a(e,t,r,this.stateHandler.getLink(t,e),!1),this.stateContext.previousState=null,this.stateContext.previousData={},this.stateContext.previousUrl=null,this.stateContext.crumbs.length>0){var n=this.stateContext.crumbs.slice(-1)[0];this.stateContext.previousState=n.state,this.stateContext.previousData=n.data,this.stateContext.previousUrl=n.url}},t.prototype.onNavigate=function(t){if(t[this.NAVIGATE_HANDLER_ID])throw new Error("Cannot add the same handler more than once");var e=this.NAVIGATE_HANDLER_ID+this.navigateHandlerId++;t[this.NAVIGATE_HANDLER_ID]=e,this.navigateHandlers[e]=t},t.prototype.offNavigate=function(t){delete this.navigateHandlers[t[this.NAVIGATE_HANDLER_ID]],delete t[this.NAVIGATE_HANDLER_ID]},t.prototype.navigate=function(t,e,r){var n=this.getNavigationLink(t,e);if(null==n)throw new Error("Invalid route data, a mandatory route parameter has not been supplied a value");this.navigateLink(n,r)},t.prototype.getNavigationLink=function(t,e){if(!this.states[t])throw new Error(t+" is not a valid State");var r=this.stateContext,n=r.crumbs,a=r.nextCrumb;return this.stateHandler.getLink(this.states[t],e,n,a)},t.prototype.canNavigateBack=function(t){return t<=this.stateContext.crumbs.length&&t>0},t.prototype.navigateBack=function(t,e){var r=this.getNavigationBackLink(t);this.navigateLink(r,e)},t.prototype.getNavigationBackLink=function(t){if(!this.canNavigateBack(t))throw new Error("The distance parameter must be greater than zero and less than or equal to the number of Crumbs ("+this.stateContext.crumbs.length+")");return this.stateContext.crumbs[this.stateContext.crumbs.length-t].url},t.prototype.refresh=function(t,e){var r=this.getRefreshLink(t);if(null==r)throw new Error("Invalid route data, a mandatory route parameter has not been supplied a value");this.navigateLink(r,e)},t.prototype.getRefreshLink=function(t){var e=this.stateContext,r=e.crumbs,n=e.nextCrumb;return this.stateHandler.getLink(this.stateContext.state,t,r,n)},t.prototype.navigateLink=function(t,e,r){var n=this;void 0===e&&(e="add"),void 0===r&&(r=!1);var a=this.stateContext.url,o=this.stateHandler.parseLink(t),i=o.state,s=o.data,u=this.getNavigateContinuation(a,i,s,t,e),l=function(){a===n.stateContext.url&&i.navigating(s,t,u,r)};this.stateContext.state?this.stateContext.state.unloading(i,s,t,l,r):i.navigating(s,t,u,r)},t.prototype.getNavigateContinuation=function(t,e,r,n,a){var o=this;return function(i){if(t===o.stateContext.url){o.setStateContext(e,r,n),o.stateContext.oldState&&o.stateContext.oldState!==e&&o.stateContext.oldState.dispose(),e.navigated(o.stateContext.data,i);for(var s in o.navigateHandlers)n===o.stateContext.url&&o.navigateHandlers[s](o.stateContext.oldState,e,o.stateContext.data,i);n===o.stateContext.url&&("none"!==a&&o.historyManager.addHistory(n,"replace"===a),o.stateContext.title&&"undefined"!=typeof document&&(document.title=o.stateContext.title))}}},t.prototype.parseLink=function(t){var e=this.stateHandler.parseLink(t),r=e.state,n=e.data;return delete n[r.crumbTrailKey],{state:r,data:n}},t.prototype.fluent=function(t){void 0===t&&(t=!1);var r=t?this.stateContext:void 0;return e(this.states,this.stateHandler,r)},t.prototype.start=function(t){this.navigateLink(null!=t?t:this.historyManager.getCurrentUrl())},t}(),k=function(){function t(e){void 0===e&&(e=""),this.applicationPath="",this.disabled="undefined"==typeof window||!(window.history&&window.history.pushState),this.applicationPath=t.prependSlash(e)}return t.prototype.init=function(t){this.navigateHistory=function(e){return t(e.state||void 0)},this.disabled||window.addEventListener("popstate",this.navigateHistory)},t.prototype.addHistory=function(t,e){var r=this.getHref(t);this.disabled||this.getHref(this.getUrl(location))===r||(e?window.history.replaceState(t,null,r):window.history.pushState(t,null,r))},t.prototype.getCurrentUrl=function(){return this.getUrl(location)},t.prototype.getHref=function(e){if(null==e)throw new Error("The Url is invalid");return this.applicationPath+t.prependSlash(e)},t.prototype.getUrl=function(t){return t.pathname.substring(this.applicationPath.length)+t.search},t.prototype.stop=function(){this.disabled||window.removeEventListener("popstate",this.navigateHistory)},t.prependSlash=function(t){return t&&"/"!==t.substring(0,1)?"/"+t:t},t}();t.State=g,t.HashHistoryManager=o,t.HTML5HistoryManager=k,t.Crumb=a,t.StateContext=n,t.StateNavigator=T}(this.Navigation=this.Navigation||{});