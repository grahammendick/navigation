(function(d){function u(b,a){for(var c=null;b;){if(b.getAttribute){var e=b.getAttribute("data-navigation");c||b.tagName!==a||"refresh"!==e||(c=b);if("noajax"===e)return null}b=b.parentNode}return c}function w(b,a){l(g,b,!0,a||{})}function l(b,a,c,e,f){b={link:b,data:a,target:e};m("navigating",b,null);c={history:c,title:f?f:d.document.title};f=new d.XMLHttpRequest;f.onreadystatechange=x(f,b,c);f.open(a?"post":"get",y(b,c));a&&f.setRequestHeader("Content-Type","application/json");f.send(d.JSON.stringify(a))}
function y(b,a){var c=b.link,c=c+(0<c.indexOf("?")?"&":"?"),c=c+("refreshajax="+d.encodeURIComponent(g)),c=c+("&navigation="+(a.history?"refresh":"history"));b.target.getAttribute&&(c=r(b.target,c,"include-current"),c=r(b.target,c,"current-keys"),c=r(b.target,c,"to-keys"));return c}function r(b,a,c){(b=b.getAttribute("data-"+c))&&(a+="&"+c.replace("-","")+"="+d.encodeURIComponent(b));return a}function x(b,a,c){var e=g;return function(){if(4===b.readyState)if(200===b.status){var f=d.JSON.parse(b.responseText);
f.Title&&(c.title=f.Title);c.panels=f.Panels;c.link=f.Link;m("navigated",a,c);f.RedirectLink?d.location.href=f.RedirectLink:g===e&&v(a,c)}else m("navigated",a,c)}}function v(b,a){var c={};c.link=g;c.title=d.document.title;c.panels={};m("updating",b,a);if(a.panels){for(var e in a.panels){var f=d.document.getElementById(e);f&&(c.panels[e]=f.innerHTML,f.innerHTML=a.panels[e])}m("updated",b,a);g!==a.link&&(e=a.link,t[g+"&"+e]=a,t[e+"&"+g]=c,-1===n.indexOf(e)&&(p[e]=[],n.push(e)),-1===p[g].indexOf(e)&&
(p[g].push(e),p[e].push(g)),a.history&&d.history.pushState(a.title,a.title,a.link));d.document.title=a.title;g=a.link}}function z(b,a){for(var c={},e={},f=[],d=n.length,g=0;g<n.length;g++)f.push(n[g]),e[n[g]]=d;for(var k=e[b]=0;0!==f.length;){k++;var h=f.sort(function(a,b){return e[a]-e[b]})[0];if(h===a){for(f=[];a;)f.push(a),a=c[a];return f.reverse()}for(var m=p[h],g=0;g<m.length;g++){var l=m[g];e[l]===d&&(e[l]=k,c[l]=h)}f.shift()}return null}function q(b){return function(a){k[b]||(k[b]=[]);k[b].push(a)}}
function m(b,a,c){if(k[b])for(var e=0;e<k[b].length;e++)k[b][e](a,c)}if(d.history&&d.history.pushState){var h={};d.document.addEventListener("click",function(b){var a=b.target,c=u(a,"A");b.ctrlKey||b.shiftKey||!c||(b.preventDefault(),l(c.getAttribute("href"),null,!0,c));"INPUT"!==a.tagName&&"BUTTON"!==a.tagName||!a.name||("submit"===a.type&&(h[a.name]=a.value),"image"===a.type&&(h[a.name+".x"]=d.Math.max(0,b.offsetX),h[a.name+".y"]=d.Math.max(0,b.offsetY)))});d.document.addEventListener("submit",
function(b){var a=u(b.target,"FORM");if(a){b.preventDefault();b=a.getAttribute("action");for(var c=a.elements,e={},f=0;f<c.length;f++){var d=c[f];!A.test(d.tagName)||!d.name||B.test(d.type)||d.disabled||C.test(d.type)&&!d.checked||(e[d.name]=d.value)}for(var g in h)e[g]=h[g];h={};l(b,e,!0,a)}});var A=/^INPUT|TEXTAREA|SELECT$/,B=/^button|image|submit|reset|file$/,C=/^checkbox|radio$/,g=d.location.pathname+d.location.search,p={};p[g]=[];var n=[g],t={};d.addEventListener("popstate",function(b){var a=
d.location.pathname+d.location.search;if(g!==a){var c=z(g,a);if(c)for(b=0;b<c.length-1;b++){var a={link:c[b+1],target:d},e=t[c[b]+"&"+c[b+1]];e.history=null;v(a,e)}else l(a,null,!1,d,b.state)}});var k={};d.refreshAjax={navigate:w,navigating:q("navigating"),navigated:q("navigated"),updating:q("updating"),updated:q("updated")}}})(window);